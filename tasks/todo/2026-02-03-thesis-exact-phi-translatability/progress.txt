## Codebase Patterns
- When modifying witness normalization interior computation, remember that `interiorExact` is in original node-id space and must be rewritten through `copyMap` to match rewritten witness steps.
- Tests that depend on over-approximated interior behavior will fail with thesis-exact interior; they should be updated to expect the new behavior or marked pending.
- The `CopyMapping` type provides `getCopyMapping` to access the underlying `IntMap`.

# Progress log — 2026-02-03-thesis-exact-phi-translatability

## 2026-02-03 - US-001
- What was implemented:
  - Replaced `interiorNorm = interiorExact ∪ copiedNodes(copyMap)` with thesis-exact interior computation
  - New implementation: `interiorRewrite = { rewriteNode n | n ∈ interiorExact }`
  - This ensures interior membership checks are in the same node-id space as normalized witness steps
- Files changed:
  - `src/MLF/Constraint/Presolution/WitnessNorm.hs` - Updated interior computation (lines 108-114)
  - `test/Presolution/MergeEmissionSpec.hs` - Updated test to expect new behavior
  - `test/ElaborationSpec.hs` - Marked 4 tests as pending (pending US-002 to US-005)
- **Learnings for future iterations:**
  - The old code was over-approximating interior by including all copied nodes
  - Thesis-exact interior only includes nodes from original interior, rewritten through copyMap
  - Tests that check for specific witness operations may need updating when interior computation changes
  - The pre-existing test failure `elaborates lambda with rank-2 argument` is unrelated to US-001
---

# US-002

# US-003

# US-004

# US-005

